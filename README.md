# SECS/GEM 다중 장비 시뮬레이터

**반도체 및 디스플레이 장비의 SECS/GEM 통신 프로토콜을 시뮬레이션하기 위한 다중 가상 장비 시뮬레이터입니다.**

본 프로젝트는 복잡한 SECS/HSMS 통신 환경을 손쉽게 구축하고, 시나리오 기반의 자동화된 테스트를 통해 장비 제어 시스템(Host)의 안정성을 검증하는 것을 목표로 합니다. 직관적인 GUI 환경을 제공하여 개발자 및 QA 엔지니어의 테스트 효율성을 극대화합니다.

## ✨ 주요 기능

- **다중 가상 장비(Device Agent) 운영**: 여러 대의 가상 장비를 동시에 실행하고, 각 장비의 상태를 실시간으로 모니터링할 수 있습니다.
- **Active & Passive 모드 지원**: 각 장비는 호스트(Active) 또는 설비(Passive) 역할을 선택하여 실제 통신 환경과 동일한 연결을 시뮬레이션합니다.
- **비주얼 시나리오 편집기**:
  - 메시지 라이브러리에서 타임라인으로 **드래그 앤 드롭**하여 손쉽게 테스트 시나리오를 작성할 수 있습니다.
  - 메시지 전송(`Send`), 응답 대기(`Wait`) 등 다양한 스텝을 조합하여 복잡한 통신 절차를 구현합니다.
  - 작성된 시나리오는 JSON 파일로 저장하고 불러올 수 있습니다.
- **상세 속성 편집**: 타임라인에서 선택된 스텝의 SECS-II 메시지 Body를 트리 뷰 형태로 직관적으로 편집할 수 있습니다.
- **실시간 로깅 및 필터링**: 모든 통신 로그를 별도의 창에서 실시간으로 확인할 수 있으며, 로그 레벨 및 텍스트 필터링 기능을 제공합니다.
- **로그 변환기**: 실제 장비에서 추출한 로그 파일(.csv)을 분석하여, 실제 통신 시간 간격(`delay`)이 반영된 테스트 시나리오와 메시지 라이브러리를 자동으로 생성합니다.

## 🛠️ 기술 스택

- **언어**: Python 3.10+
- **UI 프레임워크**: PySide6
- **비동기 처리**: `asyncio`, `qasync`

## 🚀 시작하기

### 사전 요구 사항

- Python 3.10 이상

### 설치 및 실행

1.  **가상 환경 생성 및 활성화**

    ```bash
    # venv 라는 이름의 가상 환경 생성
    python -m venv venv

    # Windows
    .\venv\Scripts\activate

    # macOS / Linux
    source venv/bin/activate
    ```

2.  **필요한 라이브러리 설치**

    ```bash
    pip install -r requirements.txt
    ```

3.  **애플리케이션 실행**

    ```bash
    python main.py
    ```

## 📖 사용 방법

### 1\. 디바이스 관리

- **추가/편집/삭제**: 왼쪽 패널 하단의 `➕ Add`, `✏️ Edit`, `🗑️ Delete` 버튼을 사용하여 디바이스 설정을 관리할 수 있습니다.
- **초기 설정**: `secs_simulator/engine/devices.json` 파일에서 직접 초기 디바이스 목록을 편집할 수 있습니다.

### 2\. 시뮬레이터 실행

- **전체 시작/중지**: `🚀 Start All`, `⏹️ Stop All` 버튼으로 모든 디바이스를 한 번에 제어합니다.
- **개별 시작/중지**: 각 디바이스 카드에 있는 `ON/OFF` 토글 버튼으로 개별 제어가 가능합니다.

### 3\. 시나리오 편집 및 실행

1.  **시나리오 작성**: 오른쪽 패널의 가장 왼쪽 'Message Libraries' 뷰에서 원하는 메시지를 가운데 'Scenario Timeline'으로 드래그 앤 드롭합니다.
2.  **속성 편집**: 타임라인에 추가된 스텝을 클릭하면, 가장 오른쪽 'Step Properties' 패널이 활성화됩니다. 여기서 `Device ID`, `Delay`, 메시지 Body 등을 상세히 설정할 수 있습니다.
3.  **시나리오 실행**: 편집이 완료되면 `▶ Run Edited Scenario` 버튼을 눌러 시나리오를 실행합니다.
4.  **저장 및 불러오기**: `📂 Load Scenario...`, `💾 Save Scenario...` 버튼을 사용하여 작업을 저장하거나 이전 작업을 불러올 수 있습니다.

### 4\. 로그 변환기 사용법

실제 장비 로그를 기반으로 현실적인 테스트 데이터를 생성할 수 있습니다.

1.  **로그 파일 준비**: 분석할 통신 로그를 `.csv` 파일 형식으로 준비합니다. (예: `realLog.csv`)

2.  **프로필 파일 확인**: 로그 파일의 컬럼 구조를 정의하는 `profile.json` 파일이 필요합니다.

3.  **스크립트 실행**: 터미널에서 아래 명령어를 실행합니다.

    ```bash
    python log_converter.py realLog.csv --profile profile.json --out ./generated_assets --device CV_01
    ```

4.  **결과 확인**: `--out`으로 지정한 폴더에 `delay`가 자동으로 계산된 시나리오 파일과 메시지 라이브러리 파일이 생성됩니다.

## 🧪 테스트

프로젝트의 안정성을 보장하기 위해 `pytest`를 사용한 테스트 코드가 포함되어 있습니다.

```bash
# 전체 테스트 실행 및 커버리지 확인 (콘솔)
pytest --cov=secs_simulator

# 테스트 커버리지 리포트를 HTML 파일로 생성
pytest --cov=secs_simulator --cov-report=html
```
